"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6043],{14875:function(e,n,r){r.d(n,{Z3:function(){return o},ms:function(){return t},s7:function(){return i}});var o=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],i="password_current",t=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:i},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},36043:function(e,n,r){var o=r(82394),i=r(21831),t=r(75582),l=r(21764),s=r(82684),u=r(69864),a=r(71180),d=r(31882),c=r(55485),p=r(85854),m=r(44085),v=r(38276),f=r(30160),h=r(17488),b=r(35686),w=r(98464),_=r(82359),x=r(14875),g=r(86735),Z=r(50178),y=r(42122),j=r(72619),O=r(28598);function C(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,o)}return r}function I(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?C(Object(r),!0).forEach((function(n){(0,o.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}n.Z=function(e){var n=e.disabledFields,r=e.hideFields,C=e.newUser,k=e.onDeleteSuccess,P=e.onSaveSuccess,A=e.showDelete,T=e.title,E=e.user,N=(0,s.useState)(!0),S=N[0],D=N[1],M=(0,s.useState)({}),L=M[0],q=M[1],R=(0,s.useState)(null),B=R[0],U=R[1],G=((0,Z.PR)()||{}).owner,F=b.ZP.statuses.list().data,H=(0,s.useMemo)((function(){var e;return(null===F||void 0===F||null===(e=F.statuses)||void 0===e?void 0:e[0])||{}}),[F]),z=H.project_type,W=H.project_uuid,K="global",Q=null,V=null;z===_.k.SUB?(K="project",Q=W):z===_.k.MAIN&&(V="The roles selected here will apply to this user globally.\n                If a user has both a global role and a workspace role,\n                then the role with higher access will take precedence.");var Y=b.ZP.roles.list({entity:K,entity_ids:Q?[Q]:[],limit_roles:!!C},{revalidateOnFocus:!1}),J=Y.data,X=(Y.mutate,(0,s.useMemo)((function(){return(null===J||void 0===J?void 0:J.roles)||[]}),[null===J||void 0===J?void 0:J.roles])),$=(0,u.Db)(C?b.ZP.users.useCreate():b.ZP.users.useUpdate(null===E||void 0===E?void 0:E.id),{onSuccess:function(e){return(0,j.wD)(e,{callback:function(e){var n=e.user,r=x.Z3.concat(x.ms).map((function(e){return e.uuid}));r.push("id");var o=(0,y.GL)(n,r);U(o),l.Am.success(C?"New user created successfully.":"User profile successfully updated.",{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(n.id)}),null===P||void 0===P||P(o)},onErrorCallback:function(e){var n=e.error,r=n.errors,o=n.exception,i=n.message,t=n.type;l.Am.error((null===r||void 0===r?void 0:r.error)||o||i,{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:t})}})}}),ee=(0,t.Z)($,2),ne=ee[0],re=ee[1].isLoading,oe=(0,u.Db)(b.ZP.users.useDelete(null===E||void 0===E?void 0:E.id),{onSuccess:function(e){return(0,j.wD)(e,{callback:function(){null===k||void 0===k||k()},onErrorCallback:function(e){var n=e.error,r=n.errors,o=n.message;alert(o),console.log(r)}})}}),ie=(0,t.Z)(oe,2),te=ie[0],le=ie[1].isLoading,se=r?(0,i.Z)(r):[];C&&se.push(x.s7);var ue=!se||!se.includes(x.s7),ae=(0,w.Z)(E);(0,s.useEffect)((function(){if(E&&(!B||(null===ae||void 0===ae?void 0:ae.id)!==(null===E||void 0===E?void 0:E.id))){var e=x.Z3.concat(x.ms).map((function(e){return e.uuid}));U((0,y.GL)(E,e))}null!==B&&void 0!==B&&B.password||null!==B&&void 0!==B&&B.password_confirmation?(null===B||void 0===B?void 0:B.password)!==(null===B||void 0===B?void 0:B.password_confirmation)?q({password_confirmation:"Password confirmation does not match."}):!ue||null!==B&&void 0!==B&&B.password_current?q(null):q({password_current:"This field is required."}):null!==B&&void 0!==B&&B.password_current&&ue?null!==B&&void 0!==B&&B.password&&null!==B&&void 0!==B&&B.password_confirmation?q(null):q({password:"This field is required.",password_confirmation:"This field is required."}):null!==B&&void 0!==B&&B.password_current||null!==B&&void 0!==B&&B.password||null!==B&&void 0!==B&&B.password_confirmation||q(null)}),[B,ue,E,ae]);var de=(0,s.useState)(!1),ce=de[0],pe=de[1],me=(0,s.useMemo)((function(){return(ce?null===B||void 0===B?void 0:B.roles_new:null===E||void 0===E?void 0:E.roles_new)||[]}),[B,ce,E]),ve=(0,s.useMemo)((function(){var e=(null===X||void 0===X?void 0:X.map((function(e){return e.id})))||[];return null===me||void 0===me?void 0:me.filter((function(n){var r=n.id;return e.includes(r)}))}),[me,X]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(p.Z,{children:T||"Edit profile"}),(0,O.jsxs)("form",{children:[x.Z3.filter((function(e){var n=e.uuid;return!se||!se.includes(n)})).map((function(e){var n=e.autoComplete,r=e.disabled,i=e.label,t=e.required,l=e.type,s=e.uuid;return(0,O.jsx)(v.Z,{mt:2,children:(0,O.jsx)(h.Z,{autoComplete:n,disabled:r&&!C,label:i,onChange:function(e){D(!1),U((function(n){return I(I({},n),{},(0,o.Z)({},s,e.target.value))}))},primary:!0,required:t,setContentOnMount:!0,type:l,value:(null===B||void 0===B?void 0:B[s])||""})},s)})),!(null!==E&&void 0!==E&&E.owner)&&!(null!==se&&void 0!==se&&se.includes("roles"))&&(0,O.jsxs)(v.Z,{mt:2,children:[V&&(0,O.jsx)(v.Z,{mb:1,children:(0,O.jsx)(f.ZP,{children:V})}),(0,O.jsx)(m.Z,{disabled:null===n||void 0===n?void 0:n.includes("roles"),label:"Roles",onChange:function(e){var n=(0,g.sE)(X,(function(n){return n.id==e.target.value}));n&&(D(!1),pe(!0),U((function(e){var r={};return(0,g.sE)(me,(function(e){return e.id==(null===n||void 0===n?void 0:n.id)}))||(r={roles_new:[].concat((0,i.Z)(me),[n])}),I(I({},e),r)})))},primary:!0,setContentOnMount:!0,children:X.map((function(e){var n=e.id,r=e.name;return(0,O.jsx)("option",{value:n,children:r},r)}))}),(0,O.jsx)(v.Z,{mb:1}),(0,O.jsx)(c.ZP,{alignItems:"center",flexWrap:"wrap",children:null===ve||void 0===ve?void 0:ve.map((function(e){var r=e.id,o=e.name;return(0,O.jsx)(v.Z,{mb:1,mr:1,children:(0,O.jsx)(d.Z,{disabled:null===n||void 0===n?void 0:n.includes("roles"),label:o,onClick:function(){D(!1),pe(!0),U((function(e){return I(I({},e),{},{roles_new:(0,g.Od)(me,(function(e){return e.id===r}))})}))},primary:!0})},"user_roles/".concat(o))}))})]}),(0,O.jsxs)(v.Z,{mt:5,children:[(0,O.jsx)(p.Z,{children:C?"Password":"Change password"}),x.ms.filter((function(e){var n=e.uuid;return!se||!se.includes(n)})).map((function(e){var n=e.autoComplete,r=e.disabled,i=e.label,t=e.required,l=e.type,s=e.uuid;return(0,O.jsx)(v.Z,{mt:2,children:(0,O.jsx)(h.Z,{autoComplete:n,disabled:r,label:i,meta:{error:null===L||void 0===L?void 0:L[s],touched:!(null===L||void 0===L||!L[s])},onChange:function(e){D(!1),U((function(n){return I(I({},n),{},(0,o.Z)({},s,e.target.value))}))},primary:!0,required:t,setContentOnMount:!0,type:l,value:(null===B||void 0===B?void 0:B[s])||""})},s)}))]}),(0,O.jsx)(v.Z,{mt:5,children:(0,O.jsxs)(c.ZP,{children:[(0,O.jsx)(a.Z,{disabled:S||L&&!(0,y.Qr)(L),loading:re,onClick:function(){var e,n=I({},B);"roles_new"in n&&(n.roles_new=null===(e=B.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));ne({user:n})},primary:!0,children:C?"Create new user":"Update user profile"}),A&&G&&(0,O.jsx)(v.Z,{ml:1,children:(0,O.jsx)(a.Z,{danger:!0,loading:le,onClick:function(){window.confirm("Are you sure you want to delete ".concat(B.username||B.email,"?"))&&te()},children:"Delete user"})})]})})]})]})}},82359:function(e,n,r){var o,i;r.d(n,{d:function(){return o},k:function(){return i}}),function(e){e.ADD_NEW_BLOCK_V2="add_new_block_v2",e.DATA_INTEGRATION_IN_BATCH_PIPELINE="data_integration_in_batch_pipeline",e.INTERACTIONS="interactions",e.LOCAL_TIMEZONE="display_local_timezone",e.OPERATION_HISTORY="operation_history"}(o||(o={})),function(e){e.MAIN="main",e.STANDALONE="standalone",e.SUB="sub"}(i||(i={}))},31882:function(e,n,r){var o=r(38626),i=r(71180),t=r(55485),l=r(30160),s=r(44897),u=r(72473),a=r(70515),d=r(61896),c=r(28598),p=o.default.div.withConfig({displayName:"Chip__ChipStyle",componentId:"sc-1ok73g-0"})(["display:inline-block;"," "," "," "," "," ",""],(function(e){return!e.primary&&"\n    background-color: ".concat((e.theme.background||s.Z.background).tag,";\n  ")}),(function(e){return e.primary&&"\n    background-color: ".concat((e.theme.chart||s.Z.chart).primary,";\n  ")}),(function(e){return!e.small&&"\n    border-radius: ".concat((a.iI+d.Al)/2,"px;\n    height: ").concat(1.5*a.iI+d.Al,"px;\n    padding: ").concat(a.iI/1.5,"px ").concat(1.25*a.iI,"px;\n  ")}),(function(e){return e.small&&"\n    border-radius: ".concat((a.iI/2+d.Al)/2,"px;\n    height: ").concat(d.Al+a.iI/2+2,"px;\n    padding: ").concat(a.iI/4,"px ").concat(a.iI,"px;\n  ")}),(function(e){return e.xsmall&&"\n    border-radius: ".concat((a.iI/1+d.Al)/1,"px;\n    height: ").concat(20,"px;\n    padding: 4px 6px;\n  ")}),(function(e){return e.border&&"\n    border: 1px solid ".concat((e.theme.content||s.Z.content).muted,";\n  ")}));n.Z=function(e){var n=e.border,r=e.children,o=e.disabled,s=e.label,d=e.monospace,m=e.onClick,v=e.primary,f=e.small,h=e.xsmall;return(0,c.jsx)(p,{border:n,primary:v,small:f,xsmall:h,children:(0,c.jsx)(i.Z,{basic:!0,disabled:o,noBackground:!0,noPadding:!0,onClick:m,transparent:!0,children:(0,c.jsxs)(t.ZP,{alignItems:"center",children:[r,s&&(0,c.jsx)(l.ZP,{monospace:d,small:f,xsmall:h,children:s}),!o&&m&&(0,c.jsx)("div",{style:{marginLeft:2}}),!o&&m&&(0,c.jsx)(u.x8,{default:v,muted:!v,size:f?a.iI:1.25*a.iI})]})})})}}}]);