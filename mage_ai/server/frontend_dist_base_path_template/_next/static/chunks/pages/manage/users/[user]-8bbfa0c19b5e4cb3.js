(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4496],{55072:function(e,n,r){"use strict";r.d(n,{Et:function(){return v},Q:function(){return c}});r(82684);var o=r(71180),t=r(55485),i=r(38276),u=r(31748),s=r(72473),l=r(79633),a=r(70515),d=r(28598),c=30,v=9;n.ZP=function(e){var n=e.page,r=e.maxPages,c=e.onUpdate,v=e.totalPages,p=[],f=r;if(f>v)p=Array.from({length:v},(function(e,n){return n}));else{var m=Math.floor(f/2),h=n-m;n+m>=v?(h=v-f+2,f-=2):n-m<=0?(h=0,f-=2):(f-=4,h=n-Math.floor(f/2)),p=Array.from({length:f},(function(e,n){return n+h}))}return(0,d.jsx)(d.Fragment,{children:v>0&&(0,d.jsxs)(t.ZP,{alignItems:"center",children:[(0,d.jsx)(o.ZP,{disabled:0===n,onClick:function(){return c(n-1)},children:(0,d.jsx)(s.PaginateArrowLeft,{size:1.5*a.iI,stroke:u.Av})}),!p.includes(0)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.Z,{ml:1,children:(0,d.jsx)(o.ZP,{borderLess:!0,noBackground:!0,onClick:function(){return c(0)},children:1})},0),!p.includes(1)&&(0,d.jsx)(i.Z,{ml:1,children:(0,d.jsx)(o.ZP,{noBackground:!0,noPadding:!0,notClickable:!0,children:"..."})},0)]}),p.map((function(e){return(0,d.jsx)(i.Z,{ml:1,children:(0,d.jsx)(o.ZP,{backgroundColor:e===n&&l.a$,borderLess:!0,noBackground:!0,notClickable:e===n,onClick:function(){e!==n&&c(e)},children:e+1})},e)})),!p.includes(v-1)&&(0,d.jsxs)(d.Fragment,{children:[!p.includes(v-2)&&(0,d.jsx)(i.Z,{ml:1,children:(0,d.jsx)(o.ZP,{noBackground:!0,noPadding:!0,notClickable:!0,children:"..."})},0),(0,d.jsx)(i.Z,{ml:1,children:(0,d.jsx)(o.ZP,{borderLess:!0,noBackground:!0,onClick:function(){return c(v-1)},children:v})},v-1)]}),(0,d.jsx)(i.Z,{ml:1}),(0,d.jsx)(o.ZP,{disabled:n===v-1,onClick:function(){return c(n+1)},children:(0,d.jsx)(s.PaginateArrowRight,{size:1.5*a.iI,stroke:u.Av})})]})})}},14875:function(e,n,r){"use strict";r.d(n,{Z3:function(){return o},ms:function(){return i},s7:function(){return t}});var o=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],t="password_current",i=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:t},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},36043:function(e,n,r){"use strict";var o=r(82394),t=r(21831),i=r(75582),u=r(21764),s=r(82684),l=r(69864),a=r(71180),d=r(31882),c=r(55485),v=r(85854),p=r(44085),f=r(38276),m=r(30160),h=r(17488),w=r(35686),b=r(98464),j=r(82359),g=r(14875),Z=r(86735),x=r(50178),P=r(42122),y=r(72619),O=r(28598);function _(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,o)}return r}function k(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?_(Object(r),!0).forEach((function(n){(0,o.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}n.Z=function(e){var n=e.disabledFields,r=e.hideFields,_=e.newUser,C=e.onDeleteSuccess,S=e.onSaveSuccess,E=e.showDelete,M=e.title,D=e.user,I=(0,s.useState)(!0),T=I[0],U=I[1],A=(0,s.useState)({}),F=A[0],N=A[1],L=(0,s.useState)(null),R=L[0],q=L[1],B=((0,x.PR)()||{}).owner,W=w.ZP.statuses.list().data,G=(0,s.useMemo)((function(){var e;return(null===W||void 0===W||null===(e=W.statuses)||void 0===e?void 0:e[0])||{}}),[W]),H=G.project_type,V=G.project_uuid,z="global",Q=null,X=null;H===j.k.SUB?(z="project",Q=V):H===j.k.MAIN&&(X="The roles selected here will apply to this user globally.\n                If a user has both a global role and a workspace role,\n                then the role with higher access will take precedence.");var $=w.ZP.roles.list({entity:z,entity_ids:Q?[Q]:[],limit_roles:!!_},{revalidateOnFocus:!1}),J=$.data,K=($.mutate,(0,s.useMemo)((function(){return(null===J||void 0===J?void 0:J.roles)||[]}),[null===J||void 0===J?void 0:J.roles])),Y=(0,l.Db)(_?w.ZP.users.useCreate():w.ZP.users.useUpdate(null===D||void 0===D?void 0:D.id),{onSuccess:function(e){return(0,y.wD)(e,{callback:function(e){var n=e.user,r=g.Z3.concat(g.ms).map((function(e){return e.uuid}));r.push("id");var o=(0,P.GL)(n,r);q(o),u.Am.success(_?"New user created successfully.":"User profile successfully updated.",{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(n.id)}),null===S||void 0===S||S(o)},onErrorCallback:function(e){var n=e.error,r=n.errors,o=n.exception,t=n.message,i=n.type;u.Am.error((null===r||void 0===r?void 0:r.error)||o||t,{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:i})}})}}),ee=(0,i.Z)(Y,2),ne=ee[0],re=ee[1].isLoading,oe=(0,l.Db)(w.ZP.users.useDelete(null===D||void 0===D?void 0:D.id),{onSuccess:function(e){return(0,y.wD)(e,{callback:function(){null===C||void 0===C||C()},onErrorCallback:function(e){var n=e.error,r=n.errors,o=n.message;alert(o),console.log(r)}})}}),te=(0,i.Z)(oe,2),ie=te[0],ue=te[1].isLoading,se=r?(0,t.Z)(r):[];_&&se.push(g.s7);var le=!se||!se.includes(g.s7),ae=(0,b.Z)(D);(0,s.useEffect)((function(){if(D&&(!R||(null===ae||void 0===ae?void 0:ae.id)!==(null===D||void 0===D?void 0:D.id))){var e=g.Z3.concat(g.ms).map((function(e){return e.uuid}));q((0,P.GL)(D,e))}null!==R&&void 0!==R&&R.password||null!==R&&void 0!==R&&R.password_confirmation?(null===R||void 0===R?void 0:R.password)!==(null===R||void 0===R?void 0:R.password_confirmation)?N({password_confirmation:"Password confirmation does not match."}):!le||null!==R&&void 0!==R&&R.password_current?N(null):N({password_current:"This field is required."}):null!==R&&void 0!==R&&R.password_current&&le?null!==R&&void 0!==R&&R.password&&null!==R&&void 0!==R&&R.password_confirmation?N(null):N({password:"This field is required.",password_confirmation:"This field is required."}):null!==R&&void 0!==R&&R.password_current||null!==R&&void 0!==R&&R.password||null!==R&&void 0!==R&&R.password_confirmation||N(null)}),[R,le,D,ae]);var de=(0,s.useState)(!1),ce=de[0],ve=de[1],pe=(0,s.useMemo)((function(){return(ce?null===R||void 0===R?void 0:R.roles_new:null===D||void 0===D?void 0:D.roles_new)||[]}),[R,ce,D]),fe=(0,s.useMemo)((function(){var e=(null===K||void 0===K?void 0:K.map((function(e){return e.id})))||[];return null===pe||void 0===pe?void 0:pe.filter((function(n){var r=n.id;return e.includes(r)}))}),[pe,K]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(v.Z,{children:M||"Edit profile"}),(0,O.jsxs)("form",{children:[g.Z3.filter((function(e){var n=e.uuid;return!se||!se.includes(n)})).map((function(e){var n=e.autoComplete,r=e.disabled,t=e.label,i=e.required,u=e.type,s=e.uuid;return(0,O.jsx)(f.Z,{mt:2,children:(0,O.jsx)(h.Z,{autoComplete:n,disabled:r&&!_,label:t,onChange:function(e){U(!1),q((function(n){return k(k({},n),{},(0,o.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null===R||void 0===R?void 0:R[s])||""})},s)})),!(null!==D&&void 0!==D&&D.owner)&&!(null!==se&&void 0!==se&&se.includes("roles"))&&(0,O.jsxs)(f.Z,{mt:2,children:[X&&(0,O.jsx)(f.Z,{mb:1,children:(0,O.jsx)(m.ZP,{children:X})}),(0,O.jsx)(p.Z,{disabled:null===n||void 0===n?void 0:n.includes("roles"),label:"Roles",onChange:function(e){var n=(0,Z.sE)(K,(function(n){return n.id==e.target.value}));n&&(U(!1),ve(!0),q((function(e){var r={};return(0,Z.sE)(pe,(function(e){return e.id==(null===n||void 0===n?void 0:n.id)}))||(r={roles_new:[].concat((0,t.Z)(pe),[n])}),k(k({},e),r)})))},primary:!0,setContentOnMount:!0,children:K.map((function(e){var n=e.id,r=e.name;return(0,O.jsx)("option",{value:n,children:r},r)}))}),(0,O.jsx)(f.Z,{mb:1}),(0,O.jsx)(c.ZP,{alignItems:"center",flexWrap:"wrap",children:null===fe||void 0===fe?void 0:fe.map((function(e){var r=e.id,o=e.name;return(0,O.jsx)(f.Z,{mb:1,mr:1,children:(0,O.jsx)(d.Z,{disabled:null===n||void 0===n?void 0:n.includes("roles"),label:o,onClick:function(){U(!1),ve(!0),q((function(e){return k(k({},e),{},{roles_new:(0,Z.Od)(pe,(function(e){return e.id===r}))})}))},primary:!0})},"user_roles/".concat(o))}))})]}),(0,O.jsxs)(f.Z,{mt:5,children:[(0,O.jsx)(v.Z,{children:_?"Password":"Change password"}),g.ms.filter((function(e){var n=e.uuid;return!se||!se.includes(n)})).map((function(e){var n=e.autoComplete,r=e.disabled,t=e.label,i=e.required,u=e.type,s=e.uuid;return(0,O.jsx)(f.Z,{mt:2,children:(0,O.jsx)(h.Z,{autoComplete:n,disabled:r,label:t,meta:{error:null===F||void 0===F?void 0:F[s],touched:!(null===F||void 0===F||!F[s])},onChange:function(e){U(!1),q((function(n){return k(k({},n),{},(0,o.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null===R||void 0===R?void 0:R[s])||""})},s)}))]}),(0,O.jsx)(f.Z,{mt:5,children:(0,O.jsxs)(c.ZP,{children:[(0,O.jsx)(a.ZP,{disabled:T||F&&!(0,P.Qr)(F),loading:re,onClick:function(){var e,n=k({},R);"roles_new"in n&&(n.roles_new=null===(e=R.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));ne({user:n})},primary:!0,children:_?"Create new user":"Update user profile"}),E&&B&&(0,O.jsx)(f.Z,{ml:1,children:(0,O.jsx)(a.ZP,{danger:!0,loading:ue,onClick:function(){window.confirm("Are you sure you want to delete ".concat(R.username||R.email,"?"))&&ie()},children:"Delete user"})})]})})]})]})}},5178:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return F}});var o=r(77837),t=r(38860),i=r.n(t),u=r(82684),s=r(34376),l=r(93808),a=r(38276),d=r(36043),c=r(75582),v=r(21831),p=r(82394),f=r(21764),m=r(69864),h=r(71180),w=r(31882),b=r(55485),j=r(55072),g=r(44085),Z=r(4190),x=r(75499),P=r(30160),y=r(35686),O=r(86735),_=r(72619),k=r(69419),C=r(28598);function S(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,o)}return r}function E(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?S(Object(r),!0).forEach((function(n){(0,p.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var M=function(e){e.fetchUser;var n=e.isLoadingWorkspaces,r=e.user,o=e.workspaces,t=(0,s.useRouter)(),i=(0,u.useState)(),l=i[0],d=i[1],S=(0,u.useState)(!0),M=S[0],D=S[1];(0,u.useEffect)((function(){r&&d(r)}),[r]);var I=(0,k.iV)(),T=null!==I&&void 0!==I&&I.page?I.page:0,U=(null===o||void 0===o?void 0:o.length)||0,A=(0,u.useMemo)((function(){return null===o||void 0===o?void 0:o.slice(10*T,10*T+10)}),[o,T]),F=(0,u.useMemo)((function(){return null===A||void 0===A?void 0:A.map((function(e){return e.project_uuid}))}),[A]),N=y.ZP.roles.list({entity:"project",entity_ids:F},{revalidateOnFocus:!1},{pauseFetch:!A}),L=N.data,R=N.isValidating,q=(N.mutate,(0,u.useCallback)((function(e){return null===e||void 0===e?void 0:e.reduce((function(e,n){var r,o=e;return null===n||void 0===n||null===(r=n.permissions)||void 0===r||r.forEach((function(e){var r=e.entity_id,t=o[r]||[];o=E(E({},o),{},(0,p.Z)({},r,[].concat((0,v.Z)(t),[n])))})),o}),{})}),[])),B=(0,u.useMemo)((function(){var e=(null===L||void 0===L?void 0:L.roles)||[];return q(e)}),[L,q]),W=(0,u.useMemo)((function(){var e=l||r,n=null===e||void 0===e?void 0:e.roles_new;return q(n)}),[q,l,r]),G=(0,m.Db)(y.ZP.users.useUpdate(null===r||void 0===r?void 0:r.id),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(){t.push("/manage/users")},onErrorCallback:function(e){var n=e.error,r=n.errors,o=n.exception,t=n.message,i=n.type;f.Am.error((null===r||void 0===r?void 0:r.error)||o||t,{position:f.Am.POSITION.BOTTOM_RIGHT,toastId:i})}})}}),H=(0,c.Z)(G,2),V=H[0],z=H[1].isLoading;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(a.Z,{p:2,children:(0,C.jsx)(h.ZP,{disabled:M,loading:z,onClick:function(){var e,n=E(E({},l),{},{roles_new:null===l||void 0===l||null===(e=l.roles_new)||void 0===e?void 0:e.map((function(e){return e.id}))});V({user:n})},primary:!0,children:"Update workspace roles"})}),R||n?(0,C.jsx)(a.Z,{p:2,children:(0,C.jsx)(Z.Z,{color:"white"})}):(0,C.jsx)(x.Z,{columnFlex:[1,1],columns:[{uuid:"Workspace"},{uuid:"Role"}],rows:null===A||void 0===A?void 0:A.map((function(e){var n=e.name,r=e.project_uuid,o=(null===B||void 0===B?void 0:B[r])||[],t=null===W||void 0===W?void 0:W[r];return[(0,C.jsx)(P.ZP,{bold:!0,children:n},"name"),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(g.Z,{label:"Roles",onChange:function(e){D(!1);var n=(0,O.sE)(o,(function(n){return n.id==e.target.value}));n&&d((function(e){var r,o=(null===e||void 0===e||null===(r=e.roles_new)||void 0===r?void 0:r.filter((function(e){return e.id!=(null===n||void 0===n?void 0:n.id)})))||[],t={roles_new:[].concat((0,v.Z)(o),[n])};return E(E({},e),t)}))},primary:!0,setContentOnMount:!0,children:o.map((function(e){var n=e.id,r=e.name;return(0,C.jsx)("option",{value:n,children:r},r)}))},"project_role"),(0,C.jsx)(a.Z,{mb:1}),(0,C.jsx)(b.ZP,{alignItems:"center",flexWrap:"wrap",children:null===t||void 0===t?void 0:t.map((function(e){var n=e.id,r=e.name;return(0,C.jsx)(a.Z,{mb:1,mr:1,children:(0,C.jsx)(w.Z,{label:r,onClick:function(){D(!1),d((function(e){return E(E({},e),{},{roles_new:(0,O.Od)((null===e||void 0===e?void 0:e.roles_new)||[],(function(e){return e.id===n}))})}))},primary:!0})},"user_roles/".concat(r))}))})]})]}))}),(0,C.jsx)(a.Z,{p:2,children:(0,C.jsx)(j.ZP,{maxPages:j.Et,onUpdate:function(e){var n=Number(e),o=E(E({},I),{},{page:n>=0?n:0});t.push("/manage/users/[user]","/manage/users/".concat(r.id,"?").concat((0,k.uM)(o)))},page:Number(T),totalPages:Math.ceil(U/10)})})]})},D=r(59533),I=r(70515),T=r(14875),U=r(75083);function A(e){var n=e.user,r=(0,s.useRouter)(),o=(0,u.useState)(null),t=o[0],i=o[1],l=null===n||void 0===n?void 0:n.id,c=y.ZP.users.detail(l),v=c.data,p=c.mutate,f=y.ZP.statuses.list().data,m=(0,u.useMemo)((function(){var e,n;return null===f||void 0===f||null===(e=f.statuses)||void 0===e||null===(n=e[0])||void 0===n?void 0:n.instance_type}),[f]),h=(0,u.useMemo)((function(){return null===v||void 0===v?void 0:v.user}),[v]);(0,u.useEffect)((function(){(0,_.bB)(v,i)}),[v]);var w=y.ZP.workspaces.list({cluster_type:m,user_id:l},{revalidateOnFocus:!1}),b=w.data,j=w.isValidating,g=(0,u.useMemo)((function(){return(0,C.jsx)(a.Z,{p:I.cd,children:(0,C.jsx)(d.Z,{hideFields:[T.s7],onDeleteSuccess:function(){return r.push("/manage/users")},onSaveSuccess:function(){return r.push("/manage/users")},showDelete:!0,title:"Edit user",user:h})})}),[r,h]),Z=(0,u.useMemo)((function(){return null===b||void 0===b?void 0:b.workspaces}),[b]);return(0,C.jsx)(D.Z,{before:g,breadcrumbs:[{label:function(){return"Workspaces"},linkProps:{as:"/manage",href:"/manage"}},{label:function(){return"Users"},linkProps:{as:"/manage/users",href:"/manage/users"}},{bold:!0,label:function(){return(null===h||void 0===h?void 0:h.username)||"User"}}],errors:t,pageName:U.L6.USERS,children:(0,C.jsx)(M,{fetchUser:p,user:h,isLoadingWorkspaces:j,workspaces:Z})})}A.getInitialProps=function(){var e=(0,o.Z)(i().mark((function e(n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.query.user,e.abrupt("return",{user:{id:r}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();var F=(0,l.Z)(A)},11976:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage/users/[user]",function(){return r(5178)}])}},function(e){e.O(0,[1557,1598,9774,2888,179],(function(){return n=11976,e(e.s=n);var n}));var n=e.O();_N_E=n}]);