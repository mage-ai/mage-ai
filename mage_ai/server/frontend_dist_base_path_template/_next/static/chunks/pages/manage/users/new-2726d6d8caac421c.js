(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3277],{14875:function(e,r,n){"use strict";n.d(r,{Z3:function(){return t},ms:function(){return u},s7:function(){return s}});var t=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],s="password_current",u=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:s},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},36043:function(e,r,n){"use strict";var t=n(82394),s=n(21831),u=n(75582),o=n(21764),l=n(82684),i=n(83455),a=n(71180),c=n(31882),d=n(55485),p=n(85854),f=n(44085),m=n(38276),w=n(30160),v=n(17488),h=n(35686),b=n(98464),Z=n(82359),j=n(14875),_=n(86735),g=n(50178),y=n(42122),O=n(72619),x=n(28598);function P(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function C(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?P(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.Z=function(e){var r=e.disabledFields,n=e.hideFields,P=e.newUser,k=e.onDeleteSuccess,S=e.onSaveSuccess,E=e.showDelete,T=e.title,D=e.user,I=(0,l.useState)(!0),N=I[0],M=I[1],q=(0,l.useState)({}),U=q[0],A=q[1],R=(0,l.useState)(null),F=R[0],L=R[1],G=((0,g.PR)()||{}).owner,B=h.ZP.statuses.list().data,H=(0,l.useMemo)((function(){var e;return(null==B||null===(e=B.statuses)||void 0===e?void 0:e[0])||{}}),[B]),W=H.project_type,X=H.project_uuid,Q="global",z=null,J=null;W===Z.k.SUB?(Q="project",z=X):W===Z.k.MAIN&&(J="The roles selected here will apply to this user globally.\n                If a user has both a global role and a workspace role,\n                then the role with higher access will take precedence.");var K=h.ZP.roles.list({entity:Q,entity_ids:z?[z]:[],limit_roles:!!P},{revalidateOnFocus:!1}),V=K.data,Y=(K.mutate,(0,l.useMemo)((function(){return(null==V?void 0:V.roles)||[]}),[null==V?void 0:V.roles])),$=(0,i.Db)(P?h.ZP.users.useCreate():h.ZP.users.useUpdate(null==D?void 0:D.id),{onSuccess:function(e){return(0,O.wD)(e,{callback:function(e){var r=e.user,n=j.Z3.concat(j.ms).map((function(e){return e.uuid}));n.push("id");var t=(0,y.GL)(r,n);L(t),o.Am.success(P?"New user created successfully.":"User profile successfully updated.",{position:o.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(r.id)}),null==S||S(t)},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.exception,s=r.message,u=r.type;o.Am.error((null==n?void 0:n.error)||t||s,{position:o.Am.POSITION.BOTTOM_RIGHT,toastId:u})}})}}),ee=(0,u.Z)($,2),re=ee[0],ne=ee[1].isLoading,te=(0,i.Db)(h.ZP.users.useDelete(null==D?void 0:D.id),{onSuccess:function(e){return(0,O.wD)(e,{callback:function(){null==k||k()},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.message;alert(t),console.log(n)}})}}),se=(0,u.Z)(te,2),ue=se[0],oe=se[1].isLoading,le=n?(0,s.Z)(n):[];P&&le.push(j.s7);var ie=!le||!le.includes(j.s7),ae=(0,b.Z)(D);(0,l.useEffect)((function(){if(D&&(!F||(null==ae?void 0:ae.id)!==(null==D?void 0:D.id))){var e=j.Z3.concat(j.ms).map((function(e){return e.uuid}));L((0,y.GL)(D,e))}null!=F&&F.password||null!=F&&F.password_confirmation?(null==F?void 0:F.password)!==(null==F?void 0:F.password_confirmation)?A({password_confirmation:"Password confirmation does not match."}):!ie||null!=F&&F.password_current?A(null):A({password_current:"This field is required."}):null!=F&&F.password_current&&ie?null!=F&&F.password&&null!=F&&F.password_confirmation?A(null):A({password:"This field is required.",password_confirmation:"This field is required."}):null!=F&&F.password_current||null!=F&&F.password||null!=F&&F.password_confirmation||A(null)}),[F,ie,D,ae]);var ce=(0,l.useState)(!1),de=ce[0],pe=ce[1],fe=(0,l.useMemo)((function(){return(de?null==F?void 0:F.roles_new:null==D?void 0:D.roles_new)||[]}),[F,de,D]),me=(0,l.useMemo)((function(){var e=(null==Y?void 0:Y.map((function(e){return e.id})))||[];return null==fe?void 0:fe.filter((function(r){var n=r.id;return e.includes(n)}))}),[fe,Y]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(p.Z,{children:T||"Edit profile"}),(0,x.jsxs)("form",{children:[j.Z3.filter((function(e){var r=e.uuid;return!le||!le.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,s=e.label,u=e.required,o=e.type,l=e.uuid;return(0,x.jsx)(m.Z,{mt:2,children:(0,x.jsx)(v.Z,{autoComplete:r,disabled:n&&!P,label:s,onChange:function(e){M(!1),L((function(r){return C(C({},r),{},(0,t.Z)({},l,e.target.value))}))},primary:!0,required:u,setContentOnMount:!0,type:o,value:(null==F?void 0:F[l])||""})},l)})),!(null!=D&&D.owner)&&!(null!=le&&le.includes("roles"))&&(0,x.jsxs)(m.Z,{mt:2,children:[J&&(0,x.jsx)(m.Z,{mb:1,children:(0,x.jsx)(w.ZP,{children:J})}),(0,x.jsx)(f.Z,{disabled:null==r?void 0:r.includes("roles"),label:"Roles",onChange:function(e){var r=(0,_.sE)(Y,(function(r){return r.id==e.target.value}));r&&(M(!1),pe(!0),L((function(e){var n={};return(0,_.sE)(fe,(function(e){return e.id==(null==r?void 0:r.id)}))||(n={roles_new:[].concat((0,s.Z)(fe),[r])}),C(C({},e),n)})))},primary:!0,setContentOnMount:!0,children:Y.map((function(e){var r=e.id,n=e.name;return(0,x.jsx)("option",{value:r,children:n},n)}))}),(0,x.jsx)(m.Z,{mb:1}),(0,x.jsx)(d.ZP,{alignItems:"center",flexWrap:"wrap",children:null==me?void 0:me.map((function(e){var n=e.id,t=e.name;return(0,x.jsx)(m.Z,{mb:1,mr:1,children:(0,x.jsx)(c.Z,{disabled:null==r?void 0:r.includes("roles"),label:t,onClick:function(){M(!1),pe(!0),L((function(e){return C(C({},e),{},{roles_new:(0,_.Od)(fe,(function(e){return e.id===n}))})}))},primary:!0})},"user_roles/".concat(t))}))})]}),(0,x.jsxs)(m.Z,{mt:5,children:[(0,x.jsx)(p.Z,{children:P?"Password":"Change password"}),j.ms.filter((function(e){var r=e.uuid;return!le||!le.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,s=e.label,u=e.required,o=e.type,l=e.uuid;return(0,x.jsx)(m.Z,{mt:2,children:(0,x.jsx)(v.Z,{autoComplete:r,disabled:n,label:s,meta:{error:null==U?void 0:U[l],touched:!(null==U||!U[l])},onChange:function(e){M(!1),L((function(r){return C(C({},r),{},(0,t.Z)({},l,e.target.value))}))},primary:!0,required:u,setContentOnMount:!0,type:o,value:(null==F?void 0:F[l])||""})},l)}))]}),(0,x.jsx)(m.Z,{mt:5,children:(0,x.jsxs)(d.ZP,{children:[(0,x.jsx)(a.ZP,{disabled:N||U&&!(0,y.Qr)(U),loading:ne,onClick:function(){var e,r=C({},F);"roles_new"in r&&(r.roles_new=null===(e=F.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));re({user:r})},primary:!0,children:P?"Create new user":"Update user profile"}),E&&G&&(0,x.jsx)(m.Z,{ml:1,children:(0,x.jsx)(a.ZP,{danger:!0,loading:oe,onClick:function(){window.confirm("Are you sure you want to delete ".concat(F.username||F.email,"?"))&&ue()},children:"Delete user"})})]})})]})]})}},37560:function(e,r,n){"use strict";n.r(r);var t=n(77837),s=n(38860),u=n.n(s),o=(n(82684),n(34376)),l=n(93808),i=n(38276),a=n(36043),c=n(59533),d=n(70515),p=n(75083),f=n(28598);function m(){var e=(0,o.useRouter)();return(0,f.jsx)(c.Z,{breadcrumbs:[{label:function(){return"Workspaces"},linkProps:{as:"/manage",href:"/manage"}},{label:function(){return"Users"},linkProps:{as:"/manage/users",href:"/manage/users"}},{bold:!0,label:function(){return"New"}}],pageName:p.L6.USERS,children:(0,f.jsx)(i.Z,{p:d.cd,children:(0,f.jsx)(a.Z,{hideFields:["roles"],newUser:!0,onSaveSuccess:function(r){e.push("/manage/users/[user]","/manage/users/".concat(null==r?void 0:r.id))},title:"Add new user",user:{}})})})}m.getInitialProps=function(){var e=(0,t.Z)(u().mark((function e(r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),r.default=(0,l.Z)(m)},94e3:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage/users/new",function(){return n(37560)}])}},function(e){e.O(0,[1557,1598,9774,2888,179],(function(){return r=94e3,e(e.s=r);var r}));var r=e.O();_N_E=r}]);