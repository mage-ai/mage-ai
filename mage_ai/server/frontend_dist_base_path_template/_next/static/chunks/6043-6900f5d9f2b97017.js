"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6043],{14875:function(e,n,r){r.d(n,{Z3:function(){return o},ms:function(){return t},s7:function(){return i}});var o=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],i="password_current",t=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:i},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},36043:function(e,n,r){var o=r(82394),i=r(21831),t=r(75582),l=r(21764),s=r(82684),u=r(69864),a=r(71180),d=r(31882),c=r(55485),p=r(85854),m=r(44085),v=r(38276),f=r(30160),h=r(17488),w=r(35686),b=r(98464),x=r(82359),g=r(14875),Z=r(86735),j=r(50178),y=r(42122),C=r(72619),_=r(28598);function O(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,o)}return r}function k(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?O(Object(r),!0).forEach((function(n){(0,o.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}n.Z=function(e){var n=e.disabledFields,r=e.hideFields,O=e.newUser,I=e.onDeleteSuccess,P=e.onSaveSuccess,S=e.showDelete,D=e.title,T=e.user,A=(0,s.useState)(!0),E=A[0],M=A[1],q=(0,s.useState)({}),N=q[0],U=q[1],L=(0,s.useState)(null),B=L[0],F=L[1],G=((0,j.PR)()||{}).owner,R=w.ZP.statuses.list().data,H=(0,s.useMemo)((function(){var e;return(null===R||void 0===R||null===(e=R.statuses)||void 0===e?void 0:e[0])||{}}),[R]),z=H.project_type,Q=H.project_uuid,W="global",J=null,K=null;z===x.k.SUB?(W="project",J=Q):z===x.k.MAIN&&(K="The roles selected here will apply to this user globally.\n                If a user has both a global role and a workspace role,\n                then the role with higher access will take precedence.");var V=w.ZP.roles.list({entity:W,entity_ids:J?[J]:[],limit_roles:!!O},{revalidateOnFocus:!1}),X=V.data,Y=(V.mutate,(0,s.useMemo)((function(){return(null===X||void 0===X?void 0:X.roles)||[]}),[null===X||void 0===X?void 0:X.roles])),$=(0,u.Db)(O?w.ZP.users.useCreate():w.ZP.users.useUpdate(null===T||void 0===T?void 0:T.id),{onSuccess:function(e){return(0,C.wD)(e,{callback:function(e){var n=e.user,r=g.Z3.concat(g.ms).map((function(e){return e.uuid}));r.push("id");var o=(0,y.GL)(n,r);F(o),l.Am.success(O?"New user created successfully.":"User profile successfully updated.",{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(n.id)}),null===P||void 0===P||P(o)},onErrorCallback:function(e){var n=e.error,r=n.errors,o=n.exception,i=n.message,t=n.type;l.Am.error((null===r||void 0===r?void 0:r.error)||o||i,{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:t})}})}}),ee=(0,t.Z)($,2),ne=ee[0],re=ee[1].isLoading,oe=(0,u.Db)(w.ZP.users.useDelete(null===T||void 0===T?void 0:T.id),{onSuccess:function(e){return(0,C.wD)(e,{callback:function(){null===I||void 0===I||I()},onErrorCallback:function(e){var n=e.error,r=n.errors,o=n.message;alert(o),console.log(r)}})}}),ie=(0,t.Z)(oe,2),te=ie[0],le=ie[1].isLoading,se=r?(0,i.Z)(r):[];O&&se.push(g.s7);var ue=!se||!se.includes(g.s7),ae=(0,b.Z)(T);(0,s.useEffect)((function(){if(T&&(!B||(null===ae||void 0===ae?void 0:ae.id)!==(null===T||void 0===T?void 0:T.id))){var e=g.Z3.concat(g.ms).map((function(e){return e.uuid}));F((0,y.GL)(T,e))}null!==B&&void 0!==B&&B.password||null!==B&&void 0!==B&&B.password_confirmation?(null===B||void 0===B?void 0:B.password)!==(null===B||void 0===B?void 0:B.password_confirmation)?U({password_confirmation:"Password confirmation does not match."}):!ue||null!==B&&void 0!==B&&B.password_current?U(null):U({password_current:"This field is required."}):null!==B&&void 0!==B&&B.password_current&&ue?null!==B&&void 0!==B&&B.password&&null!==B&&void 0!==B&&B.password_confirmation?U(null):U({password:"This field is required.",password_confirmation:"This field is required."}):null!==B&&void 0!==B&&B.password_current||null!==B&&void 0!==B&&B.password||null!==B&&void 0!==B&&B.password_confirmation||U(null)}),[B,ue,T,ae]);var de=(0,s.useState)(!1),ce=de[0],pe=de[1],me=(0,s.useMemo)((function(){return(ce?null===B||void 0===B?void 0:B.roles_new:null===T||void 0===T?void 0:T.roles_new)||[]}),[B,ce,T]),ve=(0,s.useMemo)((function(){var e=(null===Y||void 0===Y?void 0:Y.map((function(e){return e.id})))||[];return null===me||void 0===me?void 0:me.filter((function(n){var r=n.id;return e.includes(r)}))}),[me,Y]);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(p.Z,{children:D||"Edit profile"}),(0,_.jsxs)("form",{children:[g.Z3.filter((function(e){var n=e.uuid;return!se||!se.includes(n)})).map((function(e){var n=e.autoComplete,r=e.disabled,i=e.label,t=e.required,l=e.type,s=e.uuid;return(0,_.jsx)(v.Z,{mt:2,children:(0,_.jsx)(h.Z,{autoComplete:n,disabled:r&&!O,label:i,onChange:function(e){M(!1),F((function(n){return k(k({},n),{},(0,o.Z)({},s,e.target.value))}))},primary:!0,required:t,setContentOnMount:!0,type:l,value:(null===B||void 0===B?void 0:B[s])||""})},s)})),!(null!==T&&void 0!==T&&T.owner)&&!(null!==se&&void 0!==se&&se.includes("roles"))&&(0,_.jsxs)(v.Z,{mt:2,children:[K&&(0,_.jsx)(v.Z,{mb:1,children:(0,_.jsx)(f.ZP,{children:K})}),(0,_.jsx)(m.Z,{disabled:null===n||void 0===n?void 0:n.includes("roles"),label:"Roles",onChange:function(e){var n=(0,Z.sE)(Y,(function(n){return n.id==e.target.value}));n&&(M(!1),pe(!0),F((function(e){var r={};return(0,Z.sE)(me,(function(e){return e.id==(null===n||void 0===n?void 0:n.id)}))||(r={roles_new:[].concat((0,i.Z)(me),[n])}),k(k({},e),r)})))},primary:!0,setContentOnMount:!0,children:Y.map((function(e){var n=e.id,r=e.name;return(0,_.jsx)("option",{value:n,children:r},r)}))}),(0,_.jsx)(v.Z,{mb:1}),(0,_.jsx)(c.ZP,{alignItems:"center",flexWrap:"wrap",children:null===ve||void 0===ve?void 0:ve.map((function(e){var r=e.id,o=e.name;return(0,_.jsx)(v.Z,{mb:1,mr:1,children:(0,_.jsx)(d.Z,{disabled:null===n||void 0===n?void 0:n.includes("roles"),label:o,onClick:function(){M(!1),pe(!0),F((function(e){return k(k({},e),{},{roles_new:(0,Z.Od)(me,(function(e){return e.id===r}))})}))},primary:!0})},"user_roles/".concat(o))}))})]}),(0,_.jsxs)(v.Z,{mt:5,children:[(0,_.jsx)(p.Z,{children:O?"Password":"Change password"}),g.ms.filter((function(e){var n=e.uuid;return!se||!se.includes(n)})).map((function(e){var n=e.autoComplete,r=e.disabled,i=e.label,t=e.required,l=e.type,s=e.uuid;return(0,_.jsx)(v.Z,{mt:2,children:(0,_.jsx)(h.Z,{autoComplete:n,disabled:r,label:i,meta:{error:null===N||void 0===N?void 0:N[s],touched:!(null===N||void 0===N||!N[s])},onChange:function(e){M(!1),F((function(n){return k(k({},n),{},(0,o.Z)({},s,e.target.value))}))},primary:!0,required:t,setContentOnMount:!0,type:l,value:(null===B||void 0===B?void 0:B[s])||""})},s)}))]}),(0,_.jsx)(v.Z,{mt:5,children:(0,_.jsxs)(c.ZP,{children:[(0,_.jsx)(a.Z,{disabled:E||N&&!(0,y.Qr)(N),loading:re,onClick:function(){var e,n=k({},B);"roles_new"in n&&(n.roles_new=null===(e=B.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));ne({user:n})},primary:!0,children:O?"Create new user":"Update user profile"}),S&&G&&(0,_.jsx)(v.Z,{ml:1,children:(0,_.jsx)(a.Z,{danger:!0,loading:le,onClick:function(){window.confirm("Are you sure you want to delete ".concat(B.username||B.email,"?"))&&te()},children:"Delete user"})})]})})]})]})}},31882:function(e,n,r){var o=r(38626),i=r(71180),t=r(55485),l=r(30160),s=r(44897),u=r(72473),a=r(70515),d=r(61896),c=r(28598),p=o.default.div.withConfig({displayName:"Chip__ChipStyle",componentId:"sc-1ok73g-0"})(["display:inline-block;"," "," "," "," "," ",""],(function(e){return!e.primary&&"\n    background-color: ".concat((e.theme.background||s.Z.background).tag,";\n  ")}),(function(e){return e.primary&&"\n    background-color: ".concat((e.theme.chart||s.Z.chart).primary,";\n  ")}),(function(e){return!e.small&&"\n    border-radius: ".concat((a.iI+d.Al)/2,"px;\n    height: ").concat(1.5*a.iI+d.Al,"px;\n    padding: ").concat(a.iI/1.5,"px ").concat(1.25*a.iI,"px;\n  ")}),(function(e){return e.small&&"\n    border-radius: ".concat((a.iI/2+d.Al)/2,"px;\n    height: ").concat(d.Al+a.iI/2+2,"px;\n    padding: ").concat(a.iI/4,"px ").concat(a.iI,"px;\n  ")}),(function(e){return e.xsmall&&"\n    border-radius: ".concat((a.iI/1+d.Al)/1,"px;\n    height: ").concat(20,"px;\n    padding: 4px 6px;\n  ")}),(function(e){return e.border&&"\n    border: 1px solid ".concat((e.theme.content||s.Z.content).muted,";\n  ")}));n.Z=function(e){var n=e.border,r=e.children,o=e.disabled,s=e.label,d=e.monospace,m=e.onClick,v=e.primary,f=e.small,h=e.xsmall;return(0,c.jsx)(p,{border:n,primary:v,small:f,xsmall:h,children:(0,c.jsx)(i.Z,{basic:!0,disabled:o,noBackground:!0,noPadding:!0,onClick:m,transparent:!0,children:(0,c.jsxs)(t.ZP,{alignItems:"center",children:[r,s&&(0,c.jsx)(l.ZP,{monospace:d,small:f,xsmall:h,children:s}),!o&&m&&(0,c.jsx)("div",{style:{marginLeft:2}}),!o&&m&&(0,c.jsx)(u.x8,{default:v,muted:!v,size:f?a.iI:1.25*a.iI})]})})})}}}]);